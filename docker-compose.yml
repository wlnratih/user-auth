services:
  app:
    build: .
    ports:
      - "8080:1323"
    environment:
      DATABASE_URL: postgres://postgres:postgres@db:5432/database?sslmode=disable
      TOKEN_PRIVATE_KEY: "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKSndJQkFBS0NBZ0VBOGhuL0Nva3RkWTcxZzQ1aWpla21mZks4dnU3NXY0VDJBMk5naDFlZ0tEV1BLcjNnCnZlWTRuMDNuWXFuTEhGU1o5eGFyQmJ1T3FDQnl3L3hkTlZnbmJlWGQvSkl2cjJ2VFA4UkhZSnBiQnlkaTVGQSsKOGtXZzJRWkxaVXF3eEVIUWMzaFE0M1NaaHdnd21PZERkRWRjejZRZ3hTUjQ3UitLL3ptNlEwZitlR21SNU1pSgplM0wwMDQvOHhQZlNRL2c1ZTh3UWE5blBEdTN0eGcyS1RqZTZMVDJrcGZoYlhhWWtsYkR0Qi81eEd6aGNhcHFYCnVvTXAxenhsMksrNUdreUlFMmFJd2FURkpSQ0U0QSt5YkRzNDRkOC9nOVNkUFNPVFI3aUxlMWRWMG1lNlpBZDcKbktyZW9VK1hzM3YrczNMZDMzTXNTcjdqcThPaXF5Y1hSS0tFMGJzOHc1MlFQc3R6YXgxVEgyQUJlRlYvN3lwcApKSnp4ZGlXak9LOXQ4T3FjTjdPR0pkbFpNUnc2TFlCdWU1R0dnWW5IcFlRTlZZTUFlaTVSVWl0REZjUlRXWTlnCi91aFFrbUsvbkRHdnlZZHVpQytUdXVFRzFCRytYaTF6ZGQ4Ny9kWi80RlhFRFdZR3VMb2QyM2c5Z0JVaUJLL2sKSUhhTC9IODhTdW9EeDFDUkV2am5jOUhTQm55SVI0TzVpNGc3SEMvMS9kQ1VPalVCVk5MbTZId2J2aFVGb0hCRQp0Wm5ubVpTcTlNTGpCaEIzWDhQdi93WHo1SFlkL2FhNGRrdWhQOXlkNXFESXhpQktmTHFaa1hLbzY5V05mdHFCCnBoUlE3cWdNbVhjVXJvempMVHhJbm91bzlDNzhXbHpvRnF6enk5emQ3NUFLVXcxRDNpRmdQSUd1c3VrQ0F3RUEKQVFLQ0FnQllVcDJWMVdmTlBJTmJKRVhXS2RuT0Z4RSt3dVpBTlp5ZXJkR1licUpTS1AvN0F0eUx5d0tiTTR1WApsZ1F3YUxqbXlORkp2UndWUUFrK2NNSDhaUlcxWlNmd0xkRFJ1WStPOHVkcldjU2R2b080Y1lJVlZzdVFnVmhlCk1ycDhUdHBpVmVHRXFaUWREQ0xXbFlBcFdxT0VhUWMvaE1mTkVqWGVXTXdZSVpxM2lTUWRoLytJRnU4MGc1SWUKdFo1ekI0ckpIREJkZUUrdXphUnlIWng0WHFKQVFQM2hRdExxUG1PWWJMeDhyeG5LYVd4bHc5Sll5K01tejdVRQpNVTloUmN4YTc0d3l3UTdmTDhDYUVYL3hOa1hST1dYdGpWSno3SmVka2JqcEhYcUUwU3pSczEwb1VibjR0WlhOCmVBMzZuNHhNS2JOZDdYZ1h3TDZHbkRORDZkcDBCNkc5V2hyYk1EMWsycTc3YThIbW5XZXU5dmEramJERVhyT1gKVjJFZjM0ckdNOVlrZGk0di90TE9tQjA2K0ZJSDlQSE9qTGo4NG1ZUGtCYWMvOTRGTW1kVDVBaWhxR01EUWlTKwpnaUxsdzE0Sm9jRytEYWFRS01yV25nc2F0UjlnbWZ4NEMwdVVJTjFPYjl5aGpxeUN6TkpKR25zc2JtalpoZENKCmgxZHg1VDBMU1BCVCtsTXYwczdyamNCblZVQkljOG1DZzhScys2d2FkbVVTOHNWT3Z2SW0yNlhtYWNkWnVZQmUKUk12UXQ1eVR2UGN1L1VoNGhSUlB6RUVpc3hWdEFPWFZDenR4SG9TMGdRYkJSRG44cGV5K21FVEs2RlBnWk5YZwpCU0JqcWJrcFRxbzlrWnd3WHQ4b1J4cVJSeDhwYTlTdS9EZUdDRE9ZVi9BWktXOTRnUUtDQVFFQS9iWFlTSjEwClBzNG5aR3FpbXNtM3hXK1J2TGR6cmdFeHk2b0lKSWowK2dGK1FZSVoyaFBkajA0NWkvWW5lZTBlZWprdml5YlkKd2kxNkc2Y1FBaGt6YlM2M2lRSmdZbExtQUhkaHhWZVBrUG5wRXpETi9mQmV2WlJoRGtJYUEyNHdVWlZIOXVMZwpjWDhFTDhCajFwUGRISVZNMzZqait3TGVYYW5EQzltRklydWxobTNCOUNUU3EvaFFQY0IzeDRiMk4wWnN5OUZwCmlxNnBhOXVkWFN0YXF5RHErcDhlWjAzSllESjVDTWd0cFlCaXZ0Njh1aTJwVDVBbTU5M0JqZWtBS21TR1RqWGgKbGRyU1Y5OW1TcmlDTnpEYUM3R3VQV3BkelpqcTVjOWZNSkRiRmltQy9qZUdYVk8zd3dlNXZaSjV1M3dhdWFkNQp3Q1dmS2tsRGRWUEx1UUtDQVFFQTlFbFV6TkJpdUZNeFBhQmZjaXMxd3QzZ1VXQmlwZHVucFVjcmtHSGUrRFhYCjRTekk2YVZZNUs0NG1aN3FwQ0hMWjBCampOTi9NTG4zbEppSmQwNFZzQnFwU283L2VqemtrdStZNGsxZXpiZHYKVTVtTGpjYStxTFZuVnRTckw3SEdMa3M2V2tlTnp2Rmt0MDJDVGFuVndJeExPOGhzVm5tS0V4M3ZocktjN1M4Uwo2QjdId1ZxbDFoOUhYZ0FoNFJ1bDNuUVMzTldROGdIVUNBQXM5Y3lJN2Q5TEJWSExmdEZUT0h3Z1VUbnZER1VrCkZiVVVvcDIweDN4dUhtZ2JUYnNwQm9OekluQi9TeFZMeDNWWmo3NUxENTUvcEk2dkhVcmltenU2TDFENDg2angKUFVQSENxckp1c0FQb1YrSGRQc1BoVVRrUWNrR2paY3dlN2RGTHBHWXNRS0NBUUJCRDI3RlFFdGRCN1NtVllvWgpNMzFDemhlTFUyZ0F5U0doM3BwejlBTU9VVysxRU0zY1ZKZk9kZnJmMzJIRUxJQlNTM1BidFR5RW52RGZRbm9pCmI1LzJjYkp6R2Y3cGQrU3ZYZTNlazFPbms4Nm5NeTYvM2ZJTm40MDhBTXQyOGJ6R1R3ZkRVZTdJYkJBQXhzOVQKYVZ1Y1FycXg2RGQrV1AvNCtOMmhua2c3M2U3V2lETGlqc2JQZnIvazlnUkJVR1MzVEFIK1NsZE1Udm4zUkx3WAo5bFFyNmljWDJkSU1IN0J5VUw4azkyQnRQbjBVQVQ1WVova3hCQUJXR1ZIWE9GYm9pQnJBMTZSZnIxdWRXUlo4Ck50Qjlvck5ucUVyTVNRaUEvcVBPQnQyY01LbGVCNHNsOGNzdEI1anFGSU1YRUFiVGcwRy9OaWxNa3RrOEdNbUoKdnRGUkFvSUJBRTlKYWN1Y0t4NTJhZm45amwwSTUwY2JLbzVmQVVXaDJIVE5kN2RCL05PRTdrOTRjTEZjNkZBNAp0OGdzaXkzQWhqczU2OVd1WTQ3V0hTUk9xZmRlRWEzNXlVNll3UlRVcEwrSUlvLzQycmRjUFRiZUZDeHRBRDdUCnVmbTF4dVlSQmlqS1krTWZiRWhwa3UzbnEwNDN2RmZsY1JtelFHNkV2aXJjUVh6dmhmMTVsT0pmOHlldm16bTMKSnp1OFFVTEY3WDBaSVhJcG93VFpVUTlUdDBRRUljRkxBeGR6NTk5K1kwdG5Cam8yMm42a2FTVGVoQmNQcHJoRQppNTAwM3YvSXFsVWgzd0dqajcwMzZVT1F0QVB5bUh3MlRtbURvaFNZMUpuYnRkOWJvYUc4Q0tpQTBoNkZOanAxCjBkem5tNWg5VUJsS05lZWdMbzlRTGYxSmk1dkV4OUVDZ2dFQVF2dXVZMkNGRTVyL3pFU1RxOE9wb24yUlBET1YKRUd0WnlvangyRVVoMzQ2MFJZRU5ncFozNXVlR2h1bUYwQ25nVlhtY2RZRkttajVEZnluMHAwbXlQZzRkOUR0NgpBb3V1RUQrcGFFUmYxc1pDaEFlVnlVWCthQ0cwd2R0dlpNaXd0UDlRQ1BsT0FVaGlFSTFkVFhEUEJRTVhSWERVCk9RSERoQTQxVU5wVjUyUzJQajdEN2VUREcrL2JzU09DYVNrMWVaVWxDRTR1ajdLa3lIZjhoSlVWdWpCUWNxYk8Kc3JJK1ljSktjUUJ5R0N1TzF2bkhIY2dTTHZobzF5Zis0cXZiVWp3OThIL2VzS1dIWlVNNENQWVNMRTBkOFBuLwpEUU1qMUNqMGl3VGs2L0xUNUNXRU9TTHE2NkdLa0FnbG83b25NcWoraFRLa3pET3llRFora3VTUE1nPT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0="
      TOKEN_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQ0lqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FnOEFNSUlDQ2dLQ0FnRUE4aG4vQ29rdGRZNzFnNDVpamVrbQpmZks4dnU3NXY0VDJBMk5naDFlZ0tEV1BLcjNndmVZNG4wM25ZcW5MSEZTWjl4YXJCYnVPcUNCeXcveGROVmduCmJlWGQvSkl2cjJ2VFA4UkhZSnBiQnlkaTVGQSs4a1dnMlFaTFpVcXd4RUhRYzNoUTQzU1pod2d3bU9kRGRFZGMKejZRZ3hTUjQ3UitLL3ptNlEwZitlR21SNU1pSmUzTDAwNC84eFBmU1EvZzVlOHdRYTluUER1M3R4ZzJLVGplNgpMVDJrcGZoYlhhWWtsYkR0Qi81eEd6aGNhcHFYdW9NcDF6eGwySys1R2t5SUUyYUl3YVRGSlJDRTRBK3liRHM0CjRkOC9nOVNkUFNPVFI3aUxlMWRWMG1lNlpBZDduS3Jlb1UrWHMzditzM0xkMzNNc1NyN2pxOE9pcXljWFJLS0UKMGJzOHc1MlFQc3R6YXgxVEgyQUJlRlYvN3lwcEpKenhkaVdqT0s5dDhPcWNON09HSmRsWk1SdzZMWUJ1ZTVHRwpnWW5IcFlRTlZZTUFlaTVSVWl0REZjUlRXWTlnL3VoUWttSy9uREd2eVlkdWlDK1R1dUVHMUJHK1hpMXpkZDg3Ci9kWi80RlhFRFdZR3VMb2QyM2c5Z0JVaUJLL2tJSGFML0g4OFN1b0R4MUNSRXZqbmM5SFNCbnlJUjRPNWk0ZzcKSEMvMS9kQ1VPalVCVk5MbTZId2J2aFVGb0hCRXRabm5tWlNxOU1MakJoQjNYOFB2L3dYejVIWWQvYWE0ZGt1aApQOXlkNXFESXhpQktmTHFaa1hLbzY5V05mdHFCcGhSUTdxZ01tWGNVcm96akxUeElub3VvOUM3OFdsem9GcXp6Cnk5emQ3NUFLVXcxRDNpRmdQSUd1c3VrQ0F3RUFBUT09Ci0tLS0tRU5EIFBVQkxJQyBLRVktLS0tLQ=="
    depends_on:
      db:
        condition: service_healthy
  db:
    platform: linux/x86_64
    image: postgres:14.1-alpine
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: database
    ports:
      - 5432:5432
    expose:
      - 5432
    volumes:
      - db:/var/lib/postgresql/data
      # Load database schema from ./database.sql
      # If you want to reload new database schema, you need to execute
      # `docker-compose down --volumes` first to remove the volume.
      - ./database.sql:/docker-entrypoint-initdb.d/database.sql
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U postgres" ]
      interval: 10s
      timeout: 5s
      retries: 3
volumes:
  db:
    driver: local
